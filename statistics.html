<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>宿舍管理系统 - 数据统计</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap">
  <!-- 引入 Chart.js 用于图表 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans SC', sans-serif;
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    /* 侧边栏样式 */
    .sidebar {
      width: 240px;
      background: linear-gradient(180deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      padding: 20px 0;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      z-index: 100;
    }

    .logo-area {
      padding: 0 20px 30px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo {
      display: flex;
      align-items: center;
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .logo i {
      margin-right: 12px;
      font-size: 24px;
    }

    .campus-info {
      font-size: 12px;
      opacity: 0.8;
      padding-left: 36px;
    }

    .nav-links {
      list-style: none;
      padding: 20px 0;
    }

    .nav-links li {
      margin: 5px 0;
    }

    .nav-links a {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.3s;
      border-left: 4px solid transparent;
    }

    .nav-links a:hover,
    .nav-links a.active {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border-left-color: #4CAF50;
    }

    .nav-links i {
      width: 24px;
      margin-right: 12px;
      font-size: 16px;
    }

    /* 主要内容区域 */
    .main-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    /* 头部样式 */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e0e6ef;
    }

    .header-title h1 {
      font-size: 28px;
      color: #2c3e50;
      margin-bottom: 5px;
    }

    .header-title p {
      color: #7f8c8d;
      font-size: 14px;
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .search-bar {
      position: relative;
      background: white;
      border-radius: 25px;
      padding: 8px 15px 8px 40px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      border: 1px solid #e0e6ef;
    }

    .search-bar i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #95a5a6;
    }

    .search-bar input {
      border: none;
      outline: none;
      width: 200px;
      background: transparent;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      background: #3498db;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .user-details h3 {
      font-size: 16px;
      font-weight: 600;
    }

    .user-details p {
      font-size: 12px;
      color: #7f8c8d;
    }

    /* 统计卡片 */
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .summary-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
      border-top: 4px solid #3498db;
      transition: transform 0.3s;
    }

    .summary-card:hover {
      transform: translateY(-5px);
    }

    .summary-card:nth-child(2) {
      border-top-color: #f39c12;
    }

    .summary-card:nth-child(3) {
      border-top-color: #e74c3c;
    }

    .summary-card:nth-child(4) {
      border-top-color: #2ecc71;
    }

    .summary-value {
      font-size: 36px;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 5px;
    }

    .summary-label {
      font-size: 14px;
      color: #7f8c8d;
      margin-bottom: 8px;
    }

    .summary-trend {
      font-size: 12px;
      font-weight: 600;
      padding: 3px 8px;
      border-radius: 12px;
      display: inline-block;
    }

    .trend-up {
      background: #d4edda;
      color: #155724;
    }

    .trend-down {
      background: #f8d7da;
      color: #721c24;
    }

    /* 时间过滤器 */
    .stat-filters {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .stat-filter {
      padding: 8px 16px;
      background: white;
      border-radius: 5px;
      cursor: pointer;
      border: 1px solid #e0e6ef;
      font-size: 14px;
      transition: all 0.3s;
    }

    .stat-filter.active {
      background: #3498db;
      color: white;
      border-color: #3498db;
    }

    .stat-filter:hover:not(.active) {
      background: #f8f9fa;
    }

    /* 图表容器 */
    .statistics-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    @media (max-width: 768px) {
      .statistics-container {
        grid-template-columns: 1fr;
      }
    }

    .chart-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
    }

    .chart-container h3 {
      margin-bottom: 15px;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 18px;
    }

    .chart-box {
      height: 250px;
      position: relative;
      margin-bottom: 15px;
    }

    .chart-analysis {
      margin-top: 15px;
      font-size: 14px;
      color: #64748b;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 5px;
      border-left: 3px solid #3498db;
    }

    .chart-analysis strong {
      color: #2c3e50;
    }

    /* 数据表格 */
    .data-table-container {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
      margin-bottom: 25px;
    }

    .data-table-container h3 {
      margin-bottom: 20px;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 18px;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th {
      background: #f8f9fa;
      padding: 12px 15px;
      text-align: left;
      font-weight: 600;
      color: #2c3e50;
      border-bottom: 2px solid #e0e6ef;
    }

    .data-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #e0e6ef;
    }

    .data-table tr:hover {
      background: #f8f9fa;
    }

    /* 状态标签 */
    .status {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-pending {
      background: #fff8e1;
      color: #f39c12;
    }

    .status-processing {
      background: #e3f2fd;
      color: #2196f3;
    }

    .status-completed {
      background: #e8f5e9;
      color: #27ae60;
    }

    /* 按钮样式 */
    .report-actions {
      display: flex;
      gap: 12px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
      font-family: 'Noto Sans SC', sans-serif;
    }

    .btn-primary {
      background: #3498db;
      color: white;
    }

    .btn-success {
      background: #27ae60;
      color: white;
    }

    .btn-warning {
      background: #f39c12;
      color: white;
    }

    .btn-danger {
      background: #e74c3c;
      color: white;
    }

    .btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    /* 页脚 */
    .footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #e0e6ef;
      text-align: center;
      color: #7f8c8d;
      font-size: 14px;
    }

    .footer p:first-child {
      margin-bottom: 5px;
    }

    /* 表单控件 */
    .form-control {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-family: 'Noto Sans SC', sans-serif;
      transition: border 0.3s;
    }

    .form-control:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }

    /* 响应式设计 */
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        padding: 15px;
      }

      .nav-links {
        display: flex;
        overflow-x: auto;
        padding: 10px 0;
      }

      .nav-links li {
        flex-shrink: 0;
      }

      .nav-links a {
        padding: 10px;
        border-left: none;
        border-bottom: 3px solid transparent;
      }

      .nav-links a:hover,
      .nav-links a.active {
        border-left: none;
        border-bottom-color: #4CAF50;
      }

      header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }

      .header-controls {
        width: 100%;
        justify-content: space-between;
      }

      .search-bar input {
        width: 150px;
      }

      .report-actions {
        flex-direction: column;
      }

      .statistics-container {
        grid-template-columns: 1fr;
      }

      .data-table {
        display: block;
        overflow-x: auto;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <aside class="sidebar">
      <div class="logo-area">
        <div class="logo">
          <i class="fas fa-hotel"></i>
          <span>宿舍管理系统</span>
        </div>
        <div class="campus-info">四川工商学院学生宿舍管理中心</div>
      </div>
      <ul class="nav-links">
        <li><a href="index.html"><i class="fas fa-home"></i><span>系统首页</span></a></li>
        <li><a href="dorm-management.html"><i class="fas fa-building"></i><span>宿舍楼管理</span></a></li>
        <li><a href="student.html"><i class="fas fa-user-friends"></i><span>住宿学生</span></a></li>
        <li><a href="bed-assignment.html"><i class="fas fa-bed"></i><span>床位分配</span></a></li>
        <li><a href="repair.html"><i class="fas fa-tools"></i><span>报修管理</span></a></li>
        <li><a href="visitor.html"><i class="fas fa-user-check"></i><span>访客登记</span></a></li>
        <li><a href="statistics.html" class="active"><i class="fas fa-chart-bar"></i><span>数据统计</span></a></li>
        <li><a href="settings.html"><i class="fas fa-cog"></i><span>系统设置</span></a></li>
      </ul>
      </ul>
    </aside>

    <main class="main-content">
      <header>
        <div class="header-title">
          <h1>数据统计与分析</h1>
          <p>系统数据统计、分析和可视化报告</p>
        </div>
        <div class="header-controls">
          <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="搜索统计报告..." id="searchInput">
          </div>
          <div class="user-info">
            <div class="user-avatar">
              <i class="fas fa-user-tie"></i>
            </div>
            <div class="user-details">
              <h3>李管理员</h3>
              <p>宿舍管理中心</p>
            </div>
          </div>
        </div>
      </header>

      <div class="summary-cards">
        <div class="summary-card">
          <div class="summary-value" id="occupancyRate">90.8%</div>
          <div class="summary-label">整体入住率</div>
          <div class="summary-trend trend-up" id="occupancyTrend">较上月 +1.2%</div>
        </div>
        <div class="summary-card">
          <div class="summary-value" id="vacantBeds">389</div>
          <div class="summary-label">空余床位</div>
          <div class="summary-trend trend-down" id="bedsTrend">较上月 -24</div>
        </div>
        <div class="summary-card">
          <div class="summary-value" id="repairsCount">156</div>
          <div class="summary-label">本月报修量</div>
          <div class="summary-trend trend-down" id="repairsTrend">较上月 -12%</div>
        </div>
        <div class="summary-card">
          <div class="summary-value" id="visitorsCount">1,245</div>
          <div class="summary-label">本月访客数</div>
          <div class="summary-trend trend-up" id="visitorsTrend">较上月 +8%</div>
        </div>
      </div>

      <div class="stat-filters">
        <div class="stat-filter active" onclick="filterStatistics('day')">今日</div>
        <div class="stat-filter" onclick="filterStatistics('week')">本周</div>
        <div class="stat-filter" onclick="filterStatistics('month')">本月</div>
        <div class="stat-filter" onclick="filterStatistics('quarter')">本季度</div>
        <div class="stat-filter" onclick="filterStatistics('year')">全年</div>
        <select class="form-control" style="width: auto;" id="timeRangeSelect" onchange="filterByDateRange(this.value)">
          <option value="">选择时间段</option>
          <option value="2023-09">2023年9月</option>
          <option value="2023-10">2023年10月</option>
          <option value="2023-Q3">2023年第三季度</option>
          <option value="2023">2023年全年</option>
        </select>
      </div>

      <div class="statistics-container">
        <div class="chart-container">
          <h3><i class="fas fa-chart-line"></i> 入住率趋势</h3>
          <div class="chart-box">
            <canvas id="occupancyChart"></canvas>
          </div>
          <div class="chart-analysis">
            <p><strong>分析：</strong>入住率保持稳定增长，9月份新生入学达到峰值92.3%。建议在新生入学前做好床位规划和调配。</p>
          </div>
        </div>

        <div class="chart-container">
          <h3><i class="fas fa-chart-pie"></i> 学生性别分布</h3>
          <div class="chart-box">
            <canvas id="genderChart"></canvas>
          </div>
          <div class="chart-analysis">
            <p><strong>分析：</strong>男生比例略高于女生，符合工科院校特征。建议根据性别比例合理分配宿舍资源。</p>
          </div>
        </div>

        <div class="chart-container">
          <h3><i class="fas fa-chart-bar"></i> 报修类型分布</h3>
          <div class="chart-box">
            <canvas id="repairTypeChart"></canvas>
          </div>
          <div class="chart-analysis">
            <p><strong>分析：</strong>电器故障为主要报修类型，占总数的35%。建议加强电器安全检查和定期维护。</p>
          </div>
        </div>

        <div class="chart-container">
          <h3><i class="fas fa-chart-area"></i> 访客流量分析</h3>
          <div class="chart-box">
            <canvas id="visitorChart"></canvas>
          </div>
          <div class="chart-analysis">
            <p><strong>分析：</strong>周末访客量比平日高45%，节假日期间访客量显著增加。建议周末和节假日加强安保力量。</p>
          </div>
        </div>
      </div>

      <div class="data-table-container">
        <h3><i class="fas fa-table"></i> 详细数据表</h3>
        <div style="margin-bottom: 15px;">
          <select class="form-control" style="width: 200px; display: inline-block;" id="dataTableSelect"
            onchange="changeDataTable(this.value)">
            <option value="occupancy">入住率数据</option>
            <option value="repair">报修数据</option>
            <option value="visitor">访客数据</option>
            <option value="student">学生分布</option>
          </select>
        </div>

        <table class="data-table" id="statisticsTable">
          <thead>
            <tr id="tableHeader">
              <!-- 表头由JavaScript动态生成 -->
            </tr>
          </thead>
          <tbody id="tableBody">
            <!-- 表格数据由JavaScript动态生成 -->
          </tbody>
        </table>
      </div>

      <div class="report-actions">
        <button class="btn btn-primary" onclick="generatePDFReport()">
          <i class="fas fa-file-pdf"></i> 生成PDF报告
        </button>
        <button class="btn btn-success" onclick="exportExcelData()">
          <i class="fas fa-file-excel"></i> 导出Excel数据
        </button>
        <button class="btn btn-warning" onclick="printStatistics()">
          <i class="fas fa-print"></i> 打印报表
        </button>
        <button class="btn btn-danger" onclick="scheduleReport()">
          <i class="fas fa-calendar-alt"></i> 定时报告
        </button>
      </div>

      <footer class="footer">
        <p>© 2023 四川工商学院宿舍管理中心. 版权所有. 系统版本: 2.1.0</p>
        <p>数据统计时间: <span id="currentTime"></span> | 数据更新: 实时</p>
      </footer>
    </main>
  </div>

  <script>
    // 模拟数据
    const statisticsData = {
      occupancy: {
        labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
        values: [85.2, 84.8, 86.5, 87.2, 88.1, 86.7, 82.3, 83.5, 92.3, 90.8, 91.2, 91.5],
        current: 90.8,
        trend: '+1.2%'
      },
      gender: {
        labels: ['男生', '女生'],
        values: [56, 44],
        colors: ['#3498db', '#e74c3c']
      },
      repairTypes: {
        labels: ['电器故障', '水管问题', '家具损坏', '网络问题', '门窗问题', '其他'],
        values: [35, 28, 15, 12, 7, 3],
        colors: ['#e74c3c', '#3498db', '#f39c12', '#2ecc71', '#9b59b6', '#95a5a6']
      },
      visitor: {
        labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
        values: [120, 135, 128, 140, 155, 225, 210]
      },
      buildingData: [
        { building: '1号楼（男生）', totalBeds: 324, occupied: 288, vacant: 36, occupancy: 92.0, trend: '+0.5%', status: '正常' },
        { building: '2号楼（女生）', totalBeds: 378, occupied: 350, vacant: 28, occupancy: 93.0, trend: '+1.2%', status: '正常' },
        { building: '3号楼（男生）', totalBeds: 432, occupied: 376, vacant: 56, occupancy: 87.0, trend: '-2.1%', status: '有空余' },
        { building: '4号楼（女生）', totalBeds: 324, occupied: 306, vacant: 18, occupancy: 94.0, trend: '+0.8%', status: '正常' },
        { building: '5号楼（混合）', totalBeds: 288, occupied: 260, vacant: 28, occupancy: 90.3, trend: '+1.5%', status: '正常' }
      ],
      repairData: [
        { building: '1号楼', type: '电器故障', count: 28, trend: '+12%', status: '高发' },
        { building: '2号楼', type: '水管问题', count: 22, trend: '-5%', status: '正常' },
        { building: '3号楼', type: '家具损坏', count: 15, trend: '+8%', status: '中等' },
        { building: '4号楼', type: '网络问题', count: 12, trend: '+3%', status: '正常' },
        { building: '5号楼', type: '其他', count: 8, trend: '-2%', status: '正常' }
      ]
    };

    // 图表实例
    let occupancyChart, genderChart, repairTypeChart, visitorChart;
    let currentFilter = 'month';

    // 初始化
    document.addEventListener('DOMContentLoaded', function () {
      updateCurrentTime();
      setInterval(updateCurrentTime, 60000); // 每分钟更新一次时间

      initializeCharts();
      renderTable('occupancy');
      setupEventListeners();
    });

    // 更新当前时间
    function updateCurrentTime() {
      const now = new Date();
      const formattedTime = now.toLocaleString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
      document.getElementById('currentTime').textContent = formattedTime;
    }

    // 设置事件监听器
    function setupEventListeners() {
      // 搜索功能
      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('input', function (e) {
        filterTable(e.target.value);
      });

      // 时间范围选择
      document.getElementById('timeRangeSelect').addEventListener('change', function (e) {
        if (e.target.value) {
          updateChartsForRange(e.target.value);
        }
      });
    }

    // 初始化图表
    function initializeCharts() {
      // 入住率趋势图
      const occupancyCtx = document.getElementById('occupancyChart').getContext('2d');
      occupancyChart = new Chart(occupancyCtx, {
        type: 'line',
        data: {
          labels: statisticsData.occupancy.labels,
          datasets: [{
            label: '入住率 (%)',
            data: statisticsData.occupancy.values,
            borderColor: '#3498db',
            backgroundColor: 'rgba(52, 152, 219, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top'
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              min: 80,
              max: 100,
              ticks: {
                callback: function (value) {
                  return value + '%';
                }
              }
            }
          }
        }
      });

      // 性别分布饼图
      const genderCtx = document.getElementById('genderChart').getContext('2d');
      genderChart = new Chart(genderCtx, {
        type: 'doughnut',
        data: {
          labels: statisticsData.gender.labels,
          datasets: [{
            data: statisticsData.gender.values,
            backgroundColor: statisticsData.gender.colors,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            tooltip: {
              callbacks: {
                label: function (context) {
                  return context.label + ': ' + context.parsed + '%';
                }
              }
            }
          }
        }
      });

      // 报修类型柱状图
      const repairCtx = document.getElementById('repairTypeChart').getContext('2d');
      repairTypeChart = new Chart(repairCtx, {
        type: 'bar',
        data: {
          labels: statisticsData.repairTypes.labels,
          datasets: [{
            label: '报修数量 (%)',
            data: statisticsData.repairTypes.values,
            backgroundColor: statisticsData.repairTypes.colors,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              max: 40,
              ticks: {
                callback: function (value) {
                  return value + '%';
                }
              }
            }
          }
        }
      });

      // 访客流量面积图
      const visitorCtx = document.getElementById('visitorChart').getContext('2d');
      visitorChart = new Chart(visitorCtx, {
        type: 'line',
        data: {
          labels: statisticsData.visitor.labels,
          datasets: [{
            label: '访客人数',
            data: statisticsData.visitor.values,
            borderColor: '#2ecc71',
            backgroundColor: 'rgba(46, 204, 113, 0.2)',
            borderWidth: 2,
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top'
            }
          }
        }
      });
    }

    // 过滤统计
    function filterStatistics(filterType) {
      currentFilter = filterType;

      // 更新过滤器样式
      document.querySelectorAll('.stat-filter').forEach(filter => {
        filter.classList.remove('active');
      });
      event.target.classList.add('active');

      // 根据筛选类型更新数据
      updateChartsForFilter(filterType);
    }

    // 根据筛选更新图表
    function updateChartsForFilter(filterType) {
      let data;

      switch (filterType) {
        case 'day':
          data = getDailyData();
          break;
        case 'week':
          data = getWeeklyData();
          break;
        case 'month':
          data = getMonthlyData();
          break;
        case 'quarter':
          data = getQuarterlyData();
          break;
        case 'year':
          data = getYearlyData();
          break;
      }

      // 更新摘要卡片
      updateSummaryCards(data.summary);

      // 更新图表数据
      updateChartData(data);
    }

    // 更新图表数据
    function updateChartData(data) {
      if (data.occupancy) {
        occupancyChart.data.labels = data.occupancy.labels;
        occupancyChart.data.datasets[0].data = data.occupancy.values;
        occupancyChart.update();
      }

      if (data.visitor) {
        visitorChart.data.labels = data.visitor.labels;
        visitorChart.data.datasets[0].data = data.visitor.values;
        visitorChart.update();
      }
    }

    // 更新摘要卡片
    function updateSummaryCards(summary) {
      if (summary.occupancy) {
        document.getElementById('occupancyRate').textContent = summary.occupancy.value;
        document.getElementById('occupancyTrend').textContent = summary.occupancy.trend;
        document.getElementById('occupancyTrend').className =
          summary.occupancy.trend.includes('+') ? 'summary-trend trend-up' : 'summary-trend trend-down';
      }

      if (summary.vacantBeds) {
        document.getElementById('vacantBeds').textContent = summary.vacantBeds.value;
        document.getElementById('bedsTrend').textContent = summary.vacantBeds.trend;
        document.getElementById('bedsTrend').className =
          summary.vacantBeds.trend.includes('+') ? 'summary-trend trend-up' : 'summary-trend trend-down';
      }
    }

    // 模拟数据获取函数
    function getDailyData() {
      return {
        summary: {
          occupancy: { value: '91.2%', trend: '+0.4%' },
          vacantBeds: { value: '376', trend: '-13' },
          repairs: { value: '8', trend: '-2%' },
          visitors: { value: '165', trend: '+15%' }
        },
        occupancy: {
          labels: ['8:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00'],
          values: [90.5, 91.0, 91.2, 91.1, 91.3, 91.2, 91.0]
        },
        visitor: {
          labels: ['8:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00'],
          values: [15, 25, 35, 40, 30, 15, 5]
        }
      };
    }

    function getWeeklyData() {
      return {
        summary: {
          occupancy: { value: '90.5%', trend: '+0.7%' },
          vacantBeds: { value: '382', trend: '-18' },
          repairs: { value: '42', trend: '-8%' },
          visitors: { value: '865', trend: '+12%' }
        },
        occupancy: {
          labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
          values: [90.0, 90.3, 90.5, 90.7, 90.8, 90.5, 90.2]
        }
      };
    }

    function getMonthlyData() {
      return {
        summary: {
          occupancy: { value: '90.8%', trend: '+1.2%' },
          vacantBeds: { value: '389', trend: '-24' },
          repairs: { value: '156', trend: '-12%' },
          visitors: { value: '1,245', trend: '+8%' }
        }
      };
    }

    // 根据时间范围筛选
    function filterByDateRange(range) {
      if (!range) return;

      // 这里可以根据range值获取特定时间段的数据
      alert(`正在加载 ${range} 的数据...`);

      // 在实际应用中，这里会向服务器请求对应时间段的数据
      // 这里仅作演示
      if (range === '2023-09') {
        updateSummaryCards({
          occupancy: { value: '92.3%', trend: '+3.1%' },
          vacantBeds: { value: '312', trend: '-101' },
          repairs: { value: '178', trend: '+14%' },
          visitors: { value: '1,452', trend: '+25%' }
        });
      }
    }

    // 更改数据表格
    function changeDataTable(type) {
      renderTable(type);
    }

    // 渲染表格
    function renderTable(type) {
      const tableHeader = document.getElementById('tableHeader');
      const tableBody = document.getElementById('tableBody');

      let headers, rows;

      switch (type) {
        case 'occupancy':
          headers = ['楼栋', '总床位', '已占用', '空余', '入住率', '较上月', '状态'];
          rows = statisticsData.buildingData.map(item => {
            const statusClass = item.status === '正常' ? 'status-completed' :
              item.status === '有空余' ? 'status-pending' : 'status-processing';
            return `
                            <tr>
                                <td>${item.building}</td>
                                <td>${item.totalBeds}</td>
                                <td>${item.occupied}</td>
                                <td>${item.vacant}</td>
                                <td>${item.occupancy}%</td>
                                <td class="${item.trend.includes('+') ? 'trend-up' : 'trend-down'}">${item.trend}</td>
                                <td><span class="status ${statusClass}">${item.status}</span></td>
                            </tr>
                        `;
          });
          break;

        case 'repair':
          headers = ['楼栋', '主要报修类型', '数量', '较上月', '状态'];
          rows = statisticsData.repairData.map(item => {
            const statusClass = item.status === '正常' ? 'status-completed' :
              item.status === '高发' ? 'status-pending' : 'status-processing';
            return `
                            <tr>
                                <td>${item.building}</td>
                                <td>${item.type}</td>
                                <td>${item.count}</td>
                                <td class="${item.trend.includes('+') ? 'trend-up' : 'trend-down'}">${item.trend}</td>
                                <td><span class="status ${statusClass}">${item.status}</span></td>
                            </tr>
                        `;
          });
          break;

        case 'visitor':
          headers = ['日期', '访客人数', '访问时长', '访问时段', '访问目的', '状态'];
          rows = [
            ['2023-10-15', '168', '平均45分钟', '14:00-18:00', '探访同学', '正常'],
            ['2023-10-14', '152', '平均38分钟', '16:00-20:00', '家长来访', '正常'],
            ['2023-10-13', '145', '平均42分钟', '13:00-17:00', '维修服务', '正常'],
            ['2023-10-12', '128', '平均35分钟', '10:00-14:00', '快递配送', '正常'],
            ['2023-10-11', '135', '平均40分钟', '15:00-19:00', '社团活动', '正常']
          ].map(row => `
                        <tr>
                            <td>${row[0]}</td>
                            <td>${row[1]}</td>
                            <td>${row[2]}</td>
                            <td>${row[3]}</td>
                            <td>${row[4]}</td>
                            <td><span class="status status-completed">${row[5]}</span></td>
                        </tr>
                    `);
          break;

        case 'student':
          headers = ['学院', '男生', '女生', '总计', '占比', '宿舍楼', '状态'];
          rows = [
            ['计算机学院', 456, 312, 768, '25.3%', '1号楼, 3号楼', '正常'],
            ['工程学院', 512, 285, 797, '26.2%', '2号楼, 5号楼', '正常'],
            ['商学院', 278, 365, 643, '21.1%', '4号楼', '正常'],
            ['艺术学院', 156, 248, 404, '13.3%', '4号楼', '正常'],
            ['其他学院', 124, 156, 280, '9.2%', '5号楼', '正常']
          ].map(row => `
                        <tr>
                            <td>${row[0]}</td>
                            <td>${row[1]}</td>
                            <td>${row[2]}</td>
                            <td>${row[3]}</td>
                            <td>${row[4]}</td>
                            <td>${row[5]}</td>
                            <td><span class="status status-completed">${row[6]}</span></td>
                        </tr>
                    `);
          break;
      }

      // 更新表头
      tableHeader.innerHTML = headers.map(header => `<th>${header}</th>`).join('');

      // 更新表格内容
      tableBody.innerHTML = rows.join('');

      // 添加总计行
      if (type === 'occupancy') {
        const total = statisticsData.buildingData.reduce((sum, item) => ({
          totalBeds: sum.totalBeds + item.totalBeds,
          occupied: sum.occupied + item.occupied,
          vacant: sum.vacant + item.vacant
        }), { totalBeds: 0, occupied: 0, vacant: 0 });

        const totalOccupancy = ((total.occupied / total.totalBeds) * 100).toFixed(1);

        tableBody.innerHTML += `
                    <tr style="background-color: #f8f9fa; font-weight: 600;">
                        <td><strong>总计</strong></td>
                        <td><strong>${total.totalBeds}</strong></td>
                        <td><strong>${total.occupied}</strong></td>
                        <td><strong>${total.vacant}</strong></td>
                        <td><strong>${totalOccupancy}%</strong></td>
                        <td><strong>+0.1%</strong></td>
                        <td><span class="status status-processing">良好</span></td>
                    </tr>
                `;
      }
    }

    // 过滤表格内容
    function filterTable(keyword) {
      const rows = document.querySelectorAll('#statisticsTable tbody tr');
      const searchTerm = keyword.toLowerCase();

      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    }

    // 生成PDF报告
    function generatePDFReport() {
      alert('正在生成PDF报告...\n\n报告内容：\n- 入住率统计\n- 报修数据分析\n- 访客流量统计\n- 学生分布情况\n\n报告将自动下载。');

      // 模拟下载
      setTimeout(() => {
        alert('PDF报告生成完成！文件已保存。');
      }, 1500);
    }

    // 导出Excel数据
    function exportExcelData() {
      const dataType = document.getElementById('dataTableSelect').value;
      alert(`正在导出${getDataTypeName(dataType)}到Excel文件...`);

      // 模拟下载
      setTimeout(() => {
        alert('Excel文件导出完成！文件已保存。');
      }, 1500);
    }

    function getDataTypeName(type) {
      const names = {
        'occupancy': '入住率数据',
        'repair': '报修数据',
        'visitor': '访客数据',
        'student': '学生分布数据'
      };
      return names[type] || '统计数据';
    }

    // 打印报表
    function printStatistics() {
      window.print();
    }

    // 定时报告
    function scheduleReport() {
      showModal('设置定时报告', `
                <div class="form-group">
                    <label>报告类型</label>
                    <select class="form-control" id="reportType">
                        <option value="daily">日报</option>
                        <option value="weekly">周报</option>
                        <option value="monthly">月报</option>
                        <option value="quarterly">季报</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>发送时间</label>
                    <input type="time" class="form-control" id="reportTime" value="09:00">
                </div>
                <div class="form-group">
                    <label>接收邮箱</label>
                    <input type="email" class="form-control" id="reportEmail" placeholder="请输入邮箱地址" value="admin@campus.edu.cn">
                </div>
                <div class="form-group">
                    <label>报告内容</label>
                    <div style="margin-top: 8px;">
                        <label><input type="checkbox" checked> 入住率统计</label><br>
                        <label><input type="checkbox" checked> 报修分析</label><br>
                        <label><input type="checkbox" checked> 访客统计</label><br>
                        <label><input type="checkbox"> 学生分布</label>
                    </div>
                </div>
            `, function () {
        const reportType = document.getElementById('reportType').value;
        const reportTime = document.getElementById('reportTime').value;
        const email = document.getElementById('reportEmail').value;

        if (!email) {
          alert('请输入邮箱地址！');
          return false;
        }

        alert(`定时报告设置成功！\n\n报告类型：${reportType}\n发送时间：每天 ${reportTime}\n接收邮箱：${email}\n\n报告将按时发送到指定邮箱。`);
        return true;
      });
    }

    // 显示模态框函数
    function showModal(title, content, onConfirm, showConfirm = true) {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.cssText = `
                display: flex;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 1000;
                align-items: center;
                justify-content: center;
            `;

      const modalContent = document.createElement('div');
      modalContent.className = 'modal-content';
      modalContent.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 10px;
                width: 90%;
                max-width: 500px;
                max-height: 80vh;
                overflow-y: auto;
            `;

      modalContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #2c3e50;">${title}</h3>
                    <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #95a5a6;">&times;</button>
                </div>
                <div>
                    ${content}
                </div>
                ${showConfirm ? `
                    <div style="margin-top: 20px; text-align: right;">
                        <button class="btn btn-warning" onclick="this.closest('.modal').remove()">取消</button>
                        <button class="btn btn-primary" onclick="handleModalConfirm(this)" style="margin-left: 10px;">确定</button>
                    </div>
                ` : ''}
            `;

      modal.appendChild(modalContent);
      document.body.appendChild(modal);

      // 存储回调函数
      modal._onConfirm = onConfirm;
    }

    // 处理模态框确认
    function handleModalConfirm(button) {
      const modal = button.closest('.modal');
      if (modal._onConfirm) {
        const result = modal._onConfirm();
        if (result) {
          modal.remove();
        }
      } else {
        modal.remove();
      }
    }

    // 为时间范围选择更新图表
    function updateChartsForRange(range) {
      // 在实际应用中，这里会根据range向服务器请求数据
      // 这里仅作演示
      alert(`正在加载 ${range} 的数据...`);
    }
  </script>
</body>

</html>